- name: Send Notification
  when: send_notification
  tags: notify
  vars:
    prefix: "{{ lookup('pipe', 'date \"+%H:%M:%S\"') }} | "
    ## Dynamic
    message: '{{ prefix }}{{ sigdict[signal] }}'
    last_id: "{{ lookup('file', notif_id) if not first_signal else '' }}"
    last_message: "{{ lookup('file', notif_msg) if not first_signal else '' }}"
    first_signal: false ## default
  shell:
    cmd: |
      {% if first_signal %}
      echo '{{ message }}' > '{{ notif_msg }}';
      bash {{ script_phosh }} notify send "{{ notify_subject }}" "{{ message }}" > {{ notif_id }}
      {% else %}
      echo '{{ message }}' >> '{{ notif_msg }}';
         {% if replace_notif %}
      bash {{ script_phosh }} notify update {{ last_id }} "{{ notify_subject }}" "{{ message }}" "{{ last_message }}"
         {% else %}
      bash {{ script_phosh }} notify send "{{ notify_subject }}" "{{ message }}" "{{ last_message }}" >> {{ notif_id }}
         {% endif %}
      {% endif %}
